CDR_parser


В данном приложении происходит тарификация абонентов, пополнение баланса, а также формирование отчета о звонках.

1. Перед более подробным описанием работы приложения, вариант того, как можно расширить бд для нового тарифа. 
На данный момент информация о тарифах хранится в двух таблицах Tariff и Conditions. Таблица Tariff содержит номер тарифа и его название.
В таблице Conditions хранятся условия данного тарифа:
![image](https://user-images.githubusercontent.com/24692953/233848203-ce0f28b7-e22b-4e3f-8141-22f6f7c692a3.png)

fix_price - фиксированная цена, за определенное количество минут(если она есть), если ее нет то 0
max_minutes - ограничение по количеству минут для данного условия, если его нет то 0
per_minute - цена за минуту, если ее нет то 0
tariff_id - номер тарифа
type - здесь я добавила дополнительный тип: 01 - исходящие, 02 - входящие, 12 - исходящие и входящие

Для того, чтобы добавить тарифф X, необходимо добавить стринг поле, например, destination - где будет храниться информация об операторе абонента, которому/от которого идет звонок. То есть для тарифа X у нас появится дополнительный столбец и две дополнительные строчки в таблице conditions:

fix_price 0, max_minutes 0, per_minute 0, tariff_id 82, type 12, destination "Ромашка";

fix_price 0, max_minutes 0, per_minute 1.5, tariff_id 82, type 12, destination "Other";


2. Сваггер документация для проекта, при запуске доступна по ссылке http://localhost:8080/swagger-ui/index.html
![image](https://user-images.githubusercontent.com/24692953/233862645-c33c62c8-e621-4c73-866a-a2fdff924afc.png)


3. Проверка корректности работы запросов происходит через постман.
В браузере можно проверить только get запросы, так как я не делала отдельное поле для вода тела запросов в post/patch.
Работа спринг секьюрити: при вводе запроса в браузере, например, /api/manager/billing, появляется вот такое окно. Сюда для менджера вводим и логин и пароль manager.
Для абонентов логин и пароль - номер абонента. После аутентификации менеджера, ему доступны эндоинты менеджера. После аутентификации абонента ему доступны эндопоинты абонента.
![image](https://user-images.githubusercontent.com/24692953/233862920-edba3c0b-3cd2-4923-ae1f-b01c6f68b124.png)

Для проверки post/patch запросов необходимо сначала авторизоваться(в поле username и password) ввести те же данные, что указаны выше
![image](https://user-images.githubusercontent.com/24692953/233863087-00300d55-2539-4c38-8763-70dc54089ba9.png)

После какое-то время для менджера будут доступны эндпоинты менджера, для абонента - эндпоинты абонента. Таким образом через постман можем проверять запросы, в которых нужно что-то дописывать в Request body.

4. Тестовые не генерируются каждый раз новые. Берется все время одна и та же cdr, но данные, которые туда вставлены подобраны с помощью команды тестирования.
После выполнения биллинга, посмотрим как заполнена таблица со звонками.
Перед запуском таблица со звонками была пустой, а у пользователя были такие данные:
![image](https://user-images.githubusercontent.com/24692953/233865029-3759c578-e42c-49f1-9abb-c2e3f8f627e8.png)

Заполненные звонки по абоненту:
![image](https://user-images.githubusercontent.com/24692953/233865095-0dd84cbf-bfdd-472d-9056-ce3651cd0062.png)


Видим, что все исходящие звонки 02 бесплатны, как того и требует тариф. Далее звонок длится 3000 сек(50 минут) и стоимость рассчитана по 0.5р минута. После длительность звонка 70 минут, 50 из которых рассчитаны по тарифу 0.5, а 20 по тарифу 1.5. Далее все звоник рассчитаны по 1.5, что также соответсвует условиям тарифа.

Баланс пользователя стал 629, что также соответсвует ожадемому результату
![image](https://user-images.githubusercontent.com/24692953/233865213-f42a8e22-e6d8-4a03-884b-05487196ba55.png)


